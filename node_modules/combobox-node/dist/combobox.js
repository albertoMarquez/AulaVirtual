"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var _createClass=function(){function t(t,e){for(var s=0;s<e.length;s++){var i=e[s];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(e,s,i){return s&&t(e.prototype,s),i&&t(e,i),e}}(),CLASSES={BASE:"autocomplete",CONTAINER:"autocomplete-container",INPUT:"autocomplete__input",LABEL:"autocomplete__label",RESULTS:{BASE:"autocomplete__results",VISIBLE:"autocomplete__results--is-visible"},RESULT:{BASE:"autocomplete__result",SELECTED:"autocomplete__result--is-selected"},NOTICE:"autocomplete__notice",SELECT_RESULT:"autocomplete__select-result",LIST:"autocomplete__list"},KEY_CODES={ENTER:13,ESC:27,UP:38,DOWN:40},Autocomplete=function(){function t(e){var s=this;_classCallCheck(this,t),this.select=e,this.select.style.display="none",this.container=this.select.parentElement,this.container.classList.add(CLASSES.CONTAINER),this.container.style.position="relative",this.label=this.container.querySelector("label");var i=[].slice.call(e.querySelectorAll("option")),n=this.select.id+"-autocomplete";this.isVisible=!1,this.options=i.map(function(t,e){return{label:t.textContent,value:t.value,id:s.select.id+"-autocomplete-result-"+e}}),this.outputInput(n),this.outputResultsList(n),this.outputResultsNotice(n),window.requestAnimationFrame(function(){s.container.appendChild(s.input),s.container.appendChild(s.resultsList)}),this.input.addEventListener("input",function(t){var e=t.target.value.toLowerCase();s.filterResults(e)}),this.input.addEventListener("focus",function(){s.results?s.showResults():(s.updateResults(s.options),s.outputResults())}),this.input.addEventListener("blur",function(){s.hideResults()}),document.body.addEventListener("click",function(t){s.container.contains(t.target)||s.hideResults()}),document.addEventListener("keydown",function(t){s.keydownEvent(t)})}return _createClass(t,[{key:"clearSelected",value:function(){var t=this.resultsList.querySelector("."+CLASSES.RESULT.SELECTED);t&&t.classList.remove(CLASSES.RESULT.SELECTED)}},{key:"selectPreviousOption",value:function(){var t=this.resultsList.querySelector("."+CLASSES.RESULT.SELECTED);t&&(t===this.resultsList.firstChild?this.selectOption(this.resultsList.lastChild):this.selectOption(t.previousSibling))}},{key:"selectNextOption",value:function(){var t=this.resultsList.querySelector("."+CLASSES.RESULT.SELECTED);t?t===this.resultsList.lastChild?this.selectOption(this.resultsList.firstChild):this.selectOption(t.nextSibling):this.selectOption(this.resultsList.firstChild)}},{key:"selectOption",value:function(t,e){var s=this;window.requestAnimationFrame(function(){s.clearSelected(),t.classList.add(CLASSES.RESULT.SELECTED),s.input.dataset.selected=t.id,t.scrollIntoView(!1),s.resultsNotice.textContent=t.textContent,e&&e()})}},{key:"chooseOption",value:function(){var t=document.getElementById(this.input.dataset.selected);this.input.value=t.textContent,this.select.value=t.dataset.value,this.resultsNotice.textContent=t.textContent+" selected",this.hideResults()}},{key:"clearResults",value:function(){var t=this;window.requestAnimationFrame(function(){for(;t.resultsList.hasChildNodes();)t.resultsList.removeChild(t.resultsList.lastChild)})}},{key:"filterResults",value:function(t){var e=this.options.filter(function(e){return e.value.toLowerCase().indexOf(t)!=-1||e.label.toLowerCase().indexOf(t)!=-1});this.updateResults(e),this.outputResults()}},{key:"hideResults",value:function(){var t=this;this.isVisible=!1,window.requestAnimationFrame(function(){t.resultsList.classList.remove(CLASSES.RESULTS.VISIBLE),t.input.setAttribute("aria-expanded","false")})}},{key:"updateResults",value:function(t){this.clearResults(),this.results=t}},{key:"outputResults",value:function(){var t=this;if(this.results.length>0)this.results.forEach(function(e){var s=document.createElement("li");s.setAttribute("id",e.id),s.classList.add(CLASSES.RESULT.BASE),s.textContent=e.label,s.dataset.value=e.value,s.setAttribute("role","option"),s.addEventListener("click",function(e){t.selectOption(e.target,function(){return t.chooseOption()})}),window.requestAnimationFrame(function(){t.resultsList.appendChild(s)})});else{var e=document.createElement("li");e.classList.add(CLASSES.RESULT.BASE),e.textContent="No results found",window.requestAnimationFrame(function(){t.resultsList.appendChild(e)})}this.showResults()}},{key:"showResults",value:function(){var t=this;this.isVisible=!0,window.requestAnimationFrame(function(){t.resultsList.classList.add(CLASSES.RESULTS.VISIBLE),t.input.setAttribute("aria-expanded","true"),0===t.results.length?t.resultsNotice.textContent="No results found":1===t.results.length?t.resultsNotice.textContent="1 result":t.resultsNotice.textContent=t.results.length+" results"})}},{key:"outputInput",value:function(t){var e=this;this.input=document.createElement("input"),this.input.type="text",this.input.setAttribute("role","combobox"),this.input.setAttribute("aria-label","Search and select an option for "+this.label.textContent),this.input.setAttribute("aria-expanded","false"),this.input.setAttribute("aria-autocomplete","list"),this.input.setAttribute("aria-owns",t),this.input.classList.add(CLASSES.INPUT),window.requestAnimationFrame(function(){e.container.appendChild(e.input)})}},{key:"outputResultsList",value:function(t){var e=this;this.resultsList=document.createElement("ul"),this.resultsList.classList.add(CLASSES.RESULTS.BASE),this.resultsList.setAttribute("id",t),this.resultsList.setAttribute("role","listbox"),window.requestAnimationFrame(function(){e.container.appendChild(e.resultsList)})}},{key:"outputResultsNotice",value:function(){var t=this;this.resultsNotice=document.createElement("div"),this.resultsNotice.classList.add(CLASSES.NOTICE),this.resultsNotice.setAttribute("role","status"),this.resultsNotice.setAttribute("aria-live","polite"),window.requestAnimationFrame(function(){t.container.appendChild(t.resultsNotice)})}},{key:"keydownEvent",value:function(t){if(this.container.contains(t.target))switch(t.keyCode){case KEY_CODES.ENTER:this.chooseOption();break;case KEY_CODES.ESC:this.hideResults(),this.input.blur();break;case KEY_CODES.DOWN:this.isVisible?this.selectNextOption():this.showResults(),t.preventDefault();break;case KEY_CODES.UP:t.preventDefault(),this.selectPreviousOption()}}}]),t}();module.exports=Autocomplete;